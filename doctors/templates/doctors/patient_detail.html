{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-5">
    <h3>Patient Detail: {{ patient.get_full_name }}</h3>
    <p><strong>Age:</strong> {{ age|default:"N/A" }}</p>
    <p><strong>Gender:</strong> {{ patient.get_gender_display|default:"N/A" }}</p>
    <p><strong>Email:</strong> {{ patient.email }}</p>
    <p><strong>Phone Number:</strong> {{ patient.phone_number|default:"N/A" }}</p>

    <h4>Appointments</h4>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Date</th>
                <th>Time</th>
                <th>Doctor</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for appointment in appointments %}
            <tr>
                <td>{{ appointment.schedule.date }}</td>
                <td>{{ appointment.schedule.start_time|time:"h:i A" }}</td>
                <td>{{ appointment.doctor.get_full_name }}</td>
                <td>
                    {% if appointment.status == 'booked' %}
                        <span class="badge bg-primary">Scheduled</span>
                    {% elif appointment.status == 'completed' %}
                        <span class="badge bg-success">Completed</span>
                    {% elif appointment.status == 'cancelled' %}
                        <span class="badge bg-danger">Cancelled</span>
                    {% else %}
                        <span class="badge bg-secondary">{{ appointment.status }}</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'doctors:appointment_details' appointment.id %}" class="btn btn-primary btn-sm">View Details</a>
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="5">No appointments found.</td></tr>
            {% endfor %}
        </tbody>
    </table>

    <h4>Medical History</h4>
    <ul>
        {% for history in medical_history %}
        <li>{{ history.details }}</li>
        {% empty %}
        <li>No medical history available.</li>
        {% endfor %}
    </ul>

    <h4>Diagnosis Notes</h4>
    <ul>
        {% for note in diagnosis_notes %}
        <li>{{ note.created_at|date:"Y-m-d" }}: {{ note.note }}</li>
        {% empty %}
        <li>No diagnosis notes available.</li>
        {% endfor %}
    </ul>
    <a href="{% url 'doctors:add_diagnosis_note' patient.id %}" class="btn btn-primary mb-3">Add Diagnosis Note</a>

    <h4>Treatments</h4>
    <ul>
        {% for treatment in treatments %}
        <li>{{ treatment.created_at|date:"Y-m-d" }}: {{ treatment.treatment_details }}</li>
        {% empty %}
        <li>No treatments available.</li>
        {% endfor %}
    </ul>
    <a href="{% url 'doctors:add_treatment' patient.id %}" class="btn btn-primary mb-3">Add Treatment</a>

    <h4>Prescriptions</h4>
    <ul>
        {% for prescription in prescriptions %}
        <li>{{ prescription.created_at|date:"Y-m-d" }}: {{ prescription.medication.name }} - {{ prescription.dosage }}</li>
        {% empty %}
        <li>No prescriptions available.</li>
        {% endfor %}
    </ul>
    <a href="{% url 'doctors:add_prescription' patient.id %}" class="btn btn-primary mb-3">Add Prescription</a>

    <a href="{% url 'doctors:patient_list' %}" class="btn btn-secondary">Back to Patient List</a>
</div>
{% endblock %}
